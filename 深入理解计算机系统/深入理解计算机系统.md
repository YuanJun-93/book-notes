### 第一章 计算机系统漫游

#### 1.1 信息就是位+上下文

hello.c程序是以字节序列的方式存在文件中的

系统中所有的信息——包括磁盘文件、内存中的程序、内存中存放的用户数据以及网络上传送的数据，都是由一串比特表示的。

区分不同数据对象的唯一方法是我们读到这些数据对象时的上下文

- 在不同的上下文中，一个同样的字节序列可能表示一个整数、浮点数、字符串或者机器指令

#### 1.2 程序被其他程序翻译成不同的格式

在Unix系统上，从源文件到目标文件的转化是由编译器驱动程序完成的

- ``gcc -o hello hello.c``
- GCC编译器驱动程序读取源程序文件hello.c，并翻译成一个可执行目标文件hello

翻译过程分成四个阶段

- 预处理阶段。根据以字符#开头的命令，修改原始的C程序
- 编译阶段。编译器（cc1）将文本文件hello.i翻译成文本文件hello.s。它包含一个汇编语言程序
- 汇编阶段。 汇编器将hello.s翻译成机器语言指令，把这些指令打包成一种叫做可重定位目标程序的格式，并将结果保存在目标文件hello.o中（二进制文件）
- 链接阶段。如果调用了其他函数，需要将这个函数的文件合并到hello.o程序中

#### 1.4 处理器读并解释储存在内存中的指令

#####  1.4.1 系统的硬件组成

- 总线。它携带信息字节并负责在各个部件间传递，通常总线被设计成传送定长的字节块，也就是字（word）
- I/O设备。I/O（输入/输出）设备是系统与外部世界的联系通道，每个I/O设备都通过一个控制器或适配器与I/O总线相连
  - 控制器是I/O设备本身或者系统的主印制电路板（主板）上的芯片组
  - 适配器是一块插在主板插槽上的卡
  - 它们功能都是在I/O总线和I/O设备之间传递信息
- 主存。临时存储设备，在处理器执行程序时，用来存放程序和程序处理的数据
  - 从物理上来说，主存是由一组动态随机存取存储器（DRAM）芯片组成
  - 从逻辑上来说，存储器是一个线性的字节数组，每个字节都有其唯一的地址（数组索引），从0开始
- 处理器。解释（或执行）存储在主存中指令的引擎。处理器的核心是一个大小为一个字的存储设备（或寄存器），称为程序计数器（PC），在任何时刻，PC都指向主存中的某条机器语言指令（即含有该条指令的地址）
  - 加载：从主存复制一个字节或者一个字到寄存器，覆盖寄存器原来内容
  - 存储：从寄存器复制一个字节或者一个字到主存的某个位置，覆盖这个位置原来的内容
  - 操作：把两个寄存器内容复制到ALU，ALU对这两个字做算术运算，并将结果放到一个寄存器中，覆盖该寄存器原来的内容
  - 跳转：从指令本身中抽取一个字，并将这个字复制到程序计数器（PC）中，覆盖原本PC中的值

#### 1.5 高速缓存至关重要

L1和L2高速缓存是用一种静态随机访问存储器（SRAM）

在高速缓存里面放经常访问的数据

#### 1.7 操作系统管理硬件

操作系统是应用程序和硬件之间插入的一层软件，**所有应用程序对硬件的操作尝试都必须通过操作系统**

操作系统两个基本功能

- 防止硬件被失控的应用程序滥用
- 向应用程序提供简单一致的机制来控制复杂而又通常大不相同的低级硬件设备

文件是对I/O设备抽象的表示

虚拟内存是对主存和硬盘I/O设备的抽象表示

进程是对处理器、主存和I/O设备的抽象表示

##### 1.7.1 进程

进程是操作系统对一个正在运行的程序的一种抽象。

并发运行，是说一个进程的指令和另一个进程的指令是交错执行的（上下文切换）。

操作系统保持跟踪进程运行所需的所有状态信息，也就是上下文

- 比如PC和寄存器文件的当前值，以及主存的内容

从一个进程到了一个进程到转换是由操作系统内核管理的，内核是操作系统代码常驻主存的部分，当应用程序需要操作系统的某些操作时，比如读写文件，**它就执行一条特殊的系统调用（system call）指令，将控制权传递给内核**。然后内核执行被请求的操作并返回应用程序

**内核不是一个独立的进程，它是系统管理全部进程所用代码和数据结构的集合**

##### 1.7.2 线程

一个进程可以由多个称为线程的执行单元组成，**每个线程都运行在进程上下文中，并共享同样的代码和数据**

多线程之间比多进程之间更容易共享数据

线程一般比进程更高效

##### 1.7.3 虚拟内存

虚拟内存是一个抽象概念，它为每个进程提供了一个假象，即每个进程都在独占地使用主存。

**每个进程看到的内存都是一致的，称为虚拟地址空间**

进程的虚拟地址空间，从最低的地址开始，逐步向上

- 程序代码和数据。直接按照可执行目标文件的内容初始化的，在进程一开始运行时就指定了大小
- 堆。当调用malloc和free这样的C标准库函数时，堆可以动态地扩展和收缩
- 共享库。大约在地址空间的中间部分是一块用来存放像C标准库和数学库这样的共享库的代码和数据的区域
- 栈。位于用户虚拟地址空间顶部的是用户栈，编译器用它来实现函数调用，每次调用一个函数时，栈就会增长，从一个函数返回时，栈就会收缩
- 内核虚拟空间。地址空间顶部的区域是为内核保留的。不允许应用程序读写这个区域的内容或者直接调用内核代码定义的函数。

基本思想是把一个进程虚拟内存的内容存储在磁盘上，然后用主存作为磁盘的高速缓存

##### 1.7.4 文件

文件就是字节序列，仅此而已。

每个I/O设备，包括磁盘、键盘、显示器，甚至网络都可以看成是文件。

系统中的所有输入输出都是通过使用一小组称为UnixI/O的系统函数调用读写文件来实现的。

#### 1.9 重要主题

##### 1.9.2 并发和并行

**1.线程级并发**

单处理器中，传统意义上，并发只是模拟出来的，使一台计算机在它正在执行的进程间快速切换来实现的。

多核处理器是将多个CPU（称为“核”）集成到一个集成电路芯片上。

典型多核处理器的组织结构，其中微处理器芯片有4个CPU核，每个核都有自己的L1核L2高速缓存，其中的L1高速缓存分为两个部分——一个保存最近取到的指令，了一个存放数据。**这些核共享更高层次的高速缓存，以及到主存的接口**

超线程，有时称为同时多线程，是一项运行一个CPU执行多个控制流的技术。

- 它涉及CPU某些硬件有多个备份，比如程序计数器和寄存器文件，而其他的硬件部分只有一份，比如执行浮点算术运算的单元
- 常规的处理器需要大约20000个时钟周期做不同线程间转换，而超线程的处理器可以在单个周期的基础上决定要执行哪一个线程，**使得CPU能够更好地利用它的处理资源**

多处理器的使用可以从两方面提高系统性能

- 减少了在执行多个任务时模拟并发的需要
- 可以使应用程序运行得更快

**2.指令级并行**

现代处理器可以同时执行多条指令的属性称为指令级并行

如果处理器可以达到比一个周期一条指令更快的执行速率，就称为超标量处理器，大多数现代处理器都支持超标量操作

**3.单指令、多数据并行**

许多现代处理器拥有特殊的硬件，允许一条指令产生多个可以并行执行的操作，这种方式称为单指令、多数据，即SIMD并行

### 第二章 信息的表示和处理

